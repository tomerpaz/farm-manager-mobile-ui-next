{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/tomer/VSCodeProjects/farm-manager-mobile-ui-next/src/ui/tabs/map/RenderLayerPoints.js"],"sourcesContent":["import { CircleMarker } from 'react-leaflet';\nimport { MapToolTip } from '../../FarmUtil';\n\nconst RenderLayerPoints = ({ layer, onClick }) => {\n  return (\n    <div>\n      {layer.elements.map((e, index) => {\n        return (\n          <CircleMarker\n            eventHandlers={{\n              click: (event) => {\n\n                onClick(event, e, 'point', index);\n              }\n            }}\n\n            key={index + layer.id}\n            center={[e.lat, e.lng]}\n            color={layer.color}\n            fillColor={layer.color}\n            fillOpacity={1}\n            radius={15}\n          >\n            <MapToolTip\n              textArr={[e.name]} />\n          </CircleMarker>\n        );\n      })}\n    </div>\n  )\n}\n\nexport default RenderLayerPoints"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;AAEA,IAAM,oBAAoB;QAAG,cAAA,OAAO,gBAAA;IAClC,qBACE,6LAAC;kBACE,MAAM,QAAQ,CAAC,GAAG,CAAC,SAAC,GAAG;YACtB,qBACE,6LAAC,0KAAY;gBACX,eAAe;oBACb,OAAO,SAAC;wBAEN,QAAQ,OAAO,GAAG,SAAS;oBAC7B;gBACF;gBAGA,QAAQ;oBAAC,EAAE,GAAG;oBAAE,EAAE,GAAG;iBAAC;gBACtB,OAAO,MAAM,KAAK;gBAClB,WAAW,MAAM,KAAK;gBACtB,aAAa;gBACb,QAAQ;0BAER,cAAA,6LAAC,sIAAU;oBACT,SAAS;wBAAC,EAAE,IAAI;qBAAC;;;;;;eARd,QAAQ,MAAM,EAAE;;;;;QAW3B;;;;;;AAGN;KA3BM;uCA6BS"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///home/tomer/VSCodeProjects/farm-manager-mobile-ui-next/src/ui/tabs/map/FieldsMap.js"],"sourcesContent":["import { MapContainer, Polygon, useMapEvents, CircleMarker, Tooltip } from \"react-leaflet\";\nimport { useEffect, useState } from \"react\";\nimport GeoLocation from \"../../../components/GeoLocation\";\nimport { useNavigate } from \"react-router\";\nimport { Box, IconButton, Snackbar, Typography } from \"@mui/material\";\nimport { useFields } from \"../../../features/fields/fieldsApiSlice\";\nimport { useGetUserDataQuery } from '../../../features/auth/authApiSlice'\nimport { selectActiveGPS, selectCurrentYear, selectEditLayer, selectFieldFreeTextFilter, selectFieldsViewStatus, selectLang, selectLatitude, selectLongitude, selectMapCenter, selectMapZoom, selectSelectedFieldFilterOptions, selectShowFieldAlias, selectShowFieldName, selectShowLayers, selectShowOfficialFieldId, selectVisibilLayes, setEditLayer, setMapCenter, setMapZoom } from \"../../../features/app/appSlice\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport FieldsFilter from \"../../../components/filters/FieldsFilter\";\nimport { displayFieldName, filterFields, getFillColor, getOpacity, isArrayEmpty, isStringEmpty, mapDisplayFieldName, MapToolTip, MAX_PER_MAP, stopMapEventPropagation, trap } from \"../../FarmUtil\";\nimport SatelliteMapProvider from \"../../../components/map/SatelliteMapProvider\";\nimport { useGetLayersQuery, useGetPointsQuery } from \"../../../features/points/pointsApiSlice\";\nimport { Close } from \"@mui/icons-material\";\nimport PointIcon from \"../../layers/PointIcon\";\nimport PointActionDialog from \"../../dialog/PointActionDialog\";\nimport RenderLayerPoints from \"./RenderLayerPoints\";\n\n\nconst sortByEndDate = (fields) => {\n    if (fields !== null) {\n        fields?.sort((a, b) => a.endDate?.localeCompare(b.endDate));\n    }\n}\n\nconst FieldsMap = (props) => {\n\n    const dispatch = useDispatch()\n    const text = useSelector(selectLang)\n\n    const [map, setSetMap] = useState(0);\n\n    const { data: user } = useGetUserDataQuery()\n    const year = useSelector(selectCurrentYear);\n\n    const fields = useFields(year).filter(f => f.geoPoints);\n    const freeText = useSelector(selectFieldFreeTextFilter);\n    const fieldsViewStatus = useSelector(selectFieldsViewStatus);\n    const showLayers = useSelector(selectShowLayers);\n    const editLayer = useSelector(selectEditLayer);\n\n    const zoom = useSelector(selectMapZoom);\n    const center = useSelector(selectMapCenter);\n\n    const longitude = useSelector(selectLongitude);\n    const latitude = useSelector(selectLatitude);\n    const activeGPS = useSelector(selectActiveGPS);\n\n\n    const showFieldAlias = useSelector(selectShowFieldAlias);\n    const showFieldName = useSelector(selectShowFieldName);\n    const showOfficialFieldId = useSelector(selectShowOfficialFieldId);\n\n    const [selectedPoint, setSelectedPoint] = useState(null);\n    const selectedOptions = useSelector(selectSelectedFieldFilterOptions)\n\n    const displayFields = filterFields(fields, selectedOptions, freeText, fieldsViewStatus);\n\n    const visibilLayes = useSelector(selectVisibilLayes);\n    const { data: layers } = useGetLayersQuery();\n\n    const getLayers = () => {\n        return layers ? layers.filter(e => visibilLayes.includes(e.id)) : [];\n    }\n\n    sortByEndDate(displayFields);\n\n    const { data: points, isLoading: isLoadingPoints, isFetching: isFetchingPoints } = useGetPointsQuery({ types: showLayers }, { skip: isArrayEmpty(showLayers) });\n\n    function HandleMapEvents() {\n        const m = useMapEvents({\n            zoomend: () => {\n                dispatch(setMapZoom(m.getZoom()));\n            },\n            dragend: (e) => {\n                dispatch(setMapCenter([e.target.getCenter().lat, e.target.getCenter().lng]));\n\n            },\n            click: (e) => {\n\n                // console.log('lng', e.latlng.lng.toFixed(5));\n                // console.log('lat', e.latlng.lat.toFixed(5));\n\n                mapCliecked(e, null, 'map')\n            }\n        })\n        return <div></div>\n    }\n\n    useEffect(() => {\n        if (isStringEmpty(freeText) && isArrayEmpty(selectedOptions)) {\n            dispatch(setMapCenter([user.lat, user.lng]));\n        } else {\n            const c = (fields.length === displayFields.length) || isArrayEmpty(displayFields) ? center : [displayFields[0].lat, displayFields[0].lng];\n            dispatch(setMapCenter(c));\n        }\n    }, [freeText, selectedOptions])\n\n\n    useEffect(() => {\n        if (map && center) {\n            map.setView(center, zoom);\n        }\n    }, [center])\n\n\n    useEffect(() => {\n        if (map && activeGPS && longitude && latitude) {\n            map.setView([latitude, longitude], zoom);\n        }\n    }, [activeGPS, longitude, latitude])\n\n    const mapCliecked = (e, f, type) => {\n        // console.log('mapCliecked', type)\n        if (editLayer !== null) {\n            if (type === 'polygon') {\n                const p = {\n                    id: null,\n                    lat: e.latlng.lat, lng: e.latlng.lng,\n                    fieldId: f.id,\n                    name: `${text[editLayer]} - ${displayFieldName(f)}: ${points.length + 1} `,\n                    pest: null,\n                    expiry: null,\n                    active: true, type: editLayer\n                };\n                setSelectedPoint(p);\n            }\n            else if (type === 'point') {\n                setSelectedPoint(f);\n            } else if (editLayer !== trap && type === 'map') {\n                const p = {\n                    id: null,\n                    lat: e.latlng.lat, lng: e.latlng.lng,\n                    //fieldId: f.id,\n                    name: `${text[editLayer]}: ${points.length + 1} `,\n                    pest: null,\n                    expiry: null,\n                    active: true, type: editLayer\n                };\n                setSelectedPoint(p);\n            }\n\n\n            stopMapEventPropagation(e);\n\n        } else if (type === 'point') {\n            // console.log('point lng', e.latlng.lng.toFixed(5), ' lat', e.latlng.lat.toFixed(5));\n            // console.log(f);\n            setSelectedPoint(f);\n            stopMapEventPropagation(e);\n        }\n\n        else if (type === 'polygon') {\n            navigate(`/field/map/${f.id}/info`)\n        }\n\n    }\n\n    const handleCloseEditPoint = () => {\n        setSelectedPoint(null);\n    }\n\n    const handleCloseEditLayer = () => {\n        dispatch(setEditLayer(null));\n\n    }\n\n    let navigate = useNavigate();\n\n    const height = window.innerHeight - 115;\n\n    // console.log(points)\n\n    const getDisplayPoints = () => {\n        if (isArrayEmpty(showLayers) || !points || isLoadingPoints || isFetchingPoints) {\n            return [];\n        }\n        else if (editLayer) {\n            return points;\n        } else {\n            return points.filter(e => e.active === true && showLayers.includes(e.type));\n        }\n    }\n\n    const showMapToolTip = showFieldAlias || showFieldName || showOfficialFieldId;\n\n    return (\n        <Box display={'flex'} flex={1} alignItems={'stretch'} flexDirection={'column'} justifyContent={'space-between'}>\n\n            <Box flex={1} style={{ height: '100%' }} id=\"map\" dir='ltr' >\n                <MapContainer style={{ height: height, width: '100%' }} center={center} zoom={zoom} scrollWheelZoom={false}\n                    ref={setSetMap}\n                >\n                    <SatelliteMapProvider />\n                    {!activeGPS && <GeoLocation />}\n                    {activeGPS && latitude && longitude && <CircleMarker color={'white'} fillColor={'blue'} fillOpacity={1} center={[latitude, longitude]} />}\n\n                    {displayFields.map((f, index) =>\n                        <Polygon field={f} key={f.id}\n                            color={f.color}\n                            fillColor={getFillColor(f)}\n                            fillOpacity={getOpacity(f)}\n                            eventHandlers={{\n                                click: (e) => {\n                                    mapCliecked(e, f, 'polygon');\n                                }\n                            }}\n                            positions={f.geoPoints}>\n                            {showMapToolTip && index < MAX_PER_MAP && <Tooltip\n                                className={'empty-tooltip'}\n                                direction=\"center\" opacity={1} permanent>\n                                <MapToolTip textArr={[mapDisplayFieldName(f, showFieldName, showFieldAlias, showOfficialFieldId)]} />\n                            </Tooltip>}\n                        </Polygon>\n                    )}\n\n\n                    {getLayers().map((e, index, arr) =>\n                        <RenderLayerPoints key={index} layer={e} onClick={mapCliecked} />\n                    )}\n                    {getDisplayPoints().map((e, index, arr) =>\n\n                        <CircleMarker\n\n                            eventHandlers={{\n                                click: (event) => {\n\n                                    mapCliecked(event, e, 'point', index);\n                                }\n                            }}\n                            key={index} radius={12}\n                            color={e.active ? 'white' : 'gray'}\n                            weight={4}\n                            fillColor={e.active ? 'white' : 'gray'}\n                            fillOpacity={1}\n                            center={[e.lat, e.lng]}\n                        >\n                            <Tooltip\n                                className={'empty-tooltip'}\n                                direction=\"center\" opacity={1} permanent>\n                                <PointIcon point={e} />\n                            </Tooltip>\n                        </CircleMarker>\n                    )}\n                    <HandleMapEvents />\n                </MapContainer>\n\n            </Box>\n            {fields && <FieldsFilter fields={fields} />}\n            <Snackbar\n                open={editLayer !== null}\n                message={<Typography variant=\"h6\">{text[editLayer + 's']}</Typography>}\n                action={\n                    <IconButton color=\"inherit\" size=\"large\" onClick={handleCloseEditLayer}>\n                        <Close />\n                    </IconButton>\n                }\n                // sx={{ bottom: { xs: 10, sm: 0 } }}\n                sx={{ width: '100%', bottom: { xs: 10, sm: 0 } }}\n            />\n\n            {/* {selectedPoint && editLayer && <FieldPointDialog open={selectedPoint !== null} deletable={true} defaultValues={{...selectedPoint, expiry : parseISOOrNull(selectedPoint.expiry)}} handleClose={handleCloseEditPoint} />} */}\n            {selectedPoint && <PointActionDialog open={selectedPoint !== null} deletable={true} selectedPoint={selectedPoint} handleClose={handleCloseEditPoint} />}\n\n        </Box >\n    )\n}\nexport default FieldsMap;\n\n/*\n<Snackbar open={editLayer !== null} >\n<Alert\n    onClose={handleCloseEditLayer}\n    severity=\"success\"\n    variant=\"filled\"\n    sx={{ width: '100%' }}\n>\n   {editLayer}\n</Alert>\n</Snackbar>\n\n*/\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 562, "column": 3}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 566, "column": 0}, "map": {"version":3,"sources":["file:///home/tomer/VSCodeProjects/farm-manager-mobile-ui-next/src/ui/tabs/fields/FieldList.js"],"sourcesContent":["import Box from '@mui/material/Box';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemButton from '@mui/material/ListItemButton';\nimport ListItemText from '@mui/material/ListItemText';\nimport { FixedSizeList, } from 'react-window';\nimport { Divider, ListItemAvatar, Avatar, Typography } from '@mui/material';\nimport { Link } from 'react-router';\nimport { getFruitIcon } from '../../../icons/FruitIconUtil';\nimport { useSelector } from 'react-redux';\nimport { selectCurrentYear, selectFieldFreeTextFilter, selectFieldsViewStatus, selectLang, selectSelectedFieldFilterOptions } from '../../../features/app/appSlice';\nimport { useFields } from '../../../features/fields/fieldsApiSlice';\nimport { useGetUserDataQuery } from '../../../features/auth/authApiSlice';\nimport { displayFieldArea, displayFieldName, filterFields, parseDate } from '../../FarmUtil';\nimport FieldsFilter from '../../../components/filters/FieldsFilter';\n\n\nfunction renderRow(props) {\n    const { index, style, field, areaUnit, text } = props;\n\n    const cropEngName = field.cropEngName\n    return (\n        <Box style={style}>\n\n            <ListItem key={index} component={\"div\"} disablePadding \n            // secondaryAction={\n            //     <IconButton edge=\"end\" aria-label=\"delete\">\n            //         <DeleteIcon />\n            //     </IconButton>\n            // }\n            >\n                <ListItemButton  to={`/field/fields/${field.id}/info`} component={Link}>\n                    <ListItemAvatar>\n                        <Avatar sx={{backgroundColor:'white'}}>\n                            {getFruitIcon(cropEngName)}\n                        </Avatar>\n                    </ListItemAvatar>\n                    <ListItemText primary={\n                        <Box sx={{backgroundColor: field.statusColor, borderRadius: 1, paddingLeft: 1,paddingRight: 1}}  display={'flex'} flexDirection={'row'} justifyContent={'space-between'}>\n                            <Typography sx={{backgroundColor: field.statusColor, borderRadius: 1, paddingLeft: 1,paddingRight: 1}} >\n                                {displayFieldName(field)}\n                            </Typography>\n                            <Typography>\n                                {displayFieldArea(field, areaUnit, text)}\n                            </Typography>\n                        </Box>\n                    }\n                        secondary={\n                            <Box component={\"span\"} display={'flex'} flexDirection={'row'} justifyContent={'space-between'}>\n                                <Typography component={\"span\"}>\n                                    {`${field.cropName},${field.varietyName}`}\n                                </Typography>\n                                <Typography component={\"span\"}>\n                                    {`${parseDate(field.startDate)}`}\n                                </Typography>\n                            </Box>\n                        }\n                    />\n                </ListItemButton>\n            </ListItem>\n            <Divider />\n        </Box>\n    );\n}\n\n\nexport default function FieldList(props) {\n    const height = window.innerHeight - 115;\n    \n    const { data: user } = useGetUserDataQuery()\n\n    const year = useSelector(selectCurrentYear);\n\n    const fields = useFields(year)\n\n    const text =  useSelector(selectLang)\n\n    const freeText = useSelector(selectFieldFreeTextFilter);\n    const fieldsViewStatus = useSelector(selectFieldsViewStatus)\n\n\n    const selectedOptions = useSelector(selectSelectedFieldFilterOptions)\n\n    const displayFields = filterFields(fields, selectedOptions, freeText, fieldsViewStatus);\n\n    // const renderRow = (props) => {\n    //     const { index, style } = props;\n    //     return (\n    //         <Box>\n    //             <ListItem key={index} component=\"div\" disablePadding\n\n    //                 secondaryAction={\n    //                     <IconButton edge=\"end\" aria-label=\"delete\">\n    //                         <DeleteIcon />\n    //                     </IconButton>\n    //                 }\n    //             >\n    //                 <ListItemButton>\n    //                     <ListItemAvatar>\n    //                         <Avatar>\n    //                             <WorkIcon />\n    //                         </Avatar>\n    //                     </ListItemAvatar>\n    //                     <ListItemText primary={`${fields[index].name}, ${fields[index].cropName},${fields[index].varietyName}`} secondary={fields[index].startDate} />\n    //                 </ListItemButton>\n    //             </ListItem>\n    //             <Divider />\n\n\n    //         </Box>\n    //     );\n    // }\n\n    return (\n        <Box\n            sx={{ width: '100%', height: height, bgcolor: 'background.paper' }}\n        >\n            <FixedSizeList\n            direction={text.dir}\n                height={height}\n\n                itemSize={70}\n                itemCount={displayFields.length}\n                overscanCount={5}\n            >\n                {(props) => renderRow({ ...props, field: displayFields[props.index], areaUnit: user.areaUnit,  text: text })}\n\n            </FixedSizeList>\n            {fields && <FieldsFilter fields={fields} />}\n        </Box>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 828, "column": 0}, "map": {"version":3,"sources":["file:///home/tomer/VSCodeProjects/farm-manager-mobile-ui-next/src/ui/tabs/activities/ActivitiesList.js"],"sourcesContent":["import { Fragment } from 'react'\nimport { Avatar, List, ListItem, ListItemText, ListItemAvatar, Box, Button, Typography, Divider } from '@mui/material';\nimport { useSelector } from 'react-redux';\nimport { useGetActivitiesFlatQuery } from '../../../features/activities/activitiesApiSlice';\nimport { selectActivityBaseFieldFilter, selectActivityFreeTextFilter, selectActivityParentFieldFilter, \n      selectEndDateFilter, selectLang, selectSelectedActivityFilterOptions, selectSelectedActivityPlanFilterOptions, selectStartDateFilter } from '../../../features/app/appSlice';\nimport ListPager from '../../../components/ui/ListPager';\nimport Loading from '../../../components/Loading';\nimport ActivityTypeIcon from '../../../icons/ActivityTypeIcon';\nimport { useNavigate, useParams } from 'react-router';\nimport ActivitiesFilter from '../../../components/filters/ActivitiesFilter';\nimport { EXECUTED, PLAN, activityDescription, buildActiviesFilter, daysDiffToday, isArrayEmpty, parseDate, parseISOOrNull } from '../../FarmUtil';\nimport { EXECUTE_STATUS_COLOR, PLAN_PASSED_STATUS_COLOR, PLAN_STATUS_COLOR, WHITE } from '../../activity/form/header/ActivityHeaderView';\nimport { LocationOn } from '@mui/icons-material';\nimport { blue } from '@mui/material/colors';\n\nconst getColor = (e) => {\n    const s = e.status;\n    if (PLAN === s) {\n        const daysPassed = daysDiffToday(parseISOOrNull(e.execution));\n\n        return daysPassed > 2 ? PLAN_PASSED_STATUS_COLOR : PLAN_STATUS_COLOR;\n    } else if (EXECUTED === s) {\n        return EXECUTE_STATUS_COLOR;\n    }\n    return WHITE;\n\n}\n\nconst gerStatus = (s, text) => {\n    if (s) {\n        return `(${text[s.toLowerCase()]})`;\n    }\n    return null\n}\n\nconst ActivitiesList = ({ plans }) => {\n    const { page } = useParams()\n    const navigate = useNavigate();\n\n    const height = window.innerHeight - 190;\n    const maxResult = 40;\n    const isPlan = plans;\n    const orderBy = 'execution';\n    const dir = 'desc';\n\n\n    const startDateFilter = useSelector(selectStartDateFilter);\n    const endDateFilter = useSelector(selectEndDateFilter);\n\n    const activityFreeTextFilter = useSelector(selectActivityFreeTextFilter);\n    const selectedFilters = useSelector(isPlan ? selectSelectedActivityPlanFilterOptions : selectSelectedActivityFilterOptions);\n\n    const filter = buildActiviesFilter(startDateFilter, endDateFilter, activityFreeTextFilter,selectedFilters);\n\n\n    const {\n        data,\n        isLoading,\n        isSuccess,\n        isError,\n        error\n    } = useGetActivitiesFlatQuery({ page, maxResult, isPlan, orderBy, dir, filter })\n\n    const text = useSelector(selectLang)\n\n\n    if (!data || isLoading) {\n        return <Loading />\n    }\n\n\n\n    const renderRows = () => {\n        if (isSuccess) {\n            const activities = data.content;\n            return activities.map(e =>\n                <Fragment key={e.uuid}>\n                    <ListItem sx={{ backgroundColor: getColor(e) }} onClick={() => navigate(`/activity/al/${e.uuid}`)}\n\n                    >\n                        <ListItemAvatar>\n                            <Avatar sx={{ bgcolor: getColor(e) }}>\n                                <ActivityTypeIcon type={e.type} />\n                            </Avatar>\n                        </ListItemAvatar>\n                        <ListItemText primary={\n                            <Box display={'flex'} flexDirection={'row'} flex={1} justifyContent={'space-between'}>\n                                <Typography >\n                                    {`${activityDescription(e, text)} ${e.fieldDesc}`}\n                                </Typography>\n\n                                <Typography whiteSpace={'nowrap'}  >\n                                    {!isArrayEmpty(e.points) && <LocationOn sx={{ color: blue[800] }} fontSize={'small'} />}\n                                    {`${e.reference}`}\n                                    {e.status && <Box component={'span'} padding={0.5}></Box>}\n                                    {e.status && <Box borderRadius={1} backgroundColor={getColor(e)} component={'span'}>{gerStatus(e.status, text)}</Box>}\n                                </Typography>\n                            </Box>\n\n                        } secondary={parseDate(e.execution)}\n\n                        />\n                    </ListItem>\n                    <Divider />\n                </Fragment>\n            )\n        }\n    }\n\n    return (\n        <Box display={'flex'} flexDirection={'column'} flex={1}>\n            <List sx={{ height, overflow: 'auto', width: '100%', bgcolor: 'background.paper' }}>\n                {renderRows()}\n            </List>\n            <Divider />\n            <ListPager bottom={0} dir={dir} page={Number(page)} totalPages={data.totalPages} setPage={(value) => navigate(`/tabs/${isPlan ? 'plans' : 'activities'}/${value}`)} />\n            <ActivitiesFilter />\n        </Box>\n    )\n}\n\nexport default ActivitiesList"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1111, "column": 0}, "map": {"version":3,"sources":["file:///home/tomer/VSCodeProjects/farm-manager-mobile-ui-next/src/ui/tabs/inventory/InventoryTable.js"],"sourcesContent":["import React, { Fragment, useEffect, useState } from 'react'\nimport { useGetInventoryQuery } from '../../../features/inventory/inventoryApiSlice'\nimport { ROWS_PER_PAGE } from '../../dialog/FieldsSelectionDialog';\nimport { selectInventoryDateFilter, selectInventoryFreeTextFilter, selectInventoryWarehouseFilter, selectLang } from '../../../features/app/appSlice';\nimport { useSelector } from 'react-redux';\nimport { useGetUserDataQuery } from '../../../features/auth/authApiSlice';\nimport { Box, Divider, Table, TableBody, TableCell, TableContainer, TableHead, TableRow } from '@mui/material';\nimport { cellSx, cellSxColor, headerSx } from '../../Util';\nimport { isStringEmpty } from '../../FarmUtil';\nimport InventoryFilter from '../../../components/filters/InventoryFilter';\nimport ListPager from '../../../components/ui/ListPager';\nimport Loading from '../../../components/Loading';\n\nconst filterData = (data, freeText, warehouseFilter) =>{\n\n  let result = isStringEmpty(freeText) ? data : data.filter(e => e.resource.name.includes(freeText));\n\n  if(warehouseFilter){\n    result = result.filter(e=>e.warehouse.id === warehouseFilter);\n  } else {\n    result = result.filter(e=>true);\n  }\n  return result;\n\n}\n\nfunction InventoryTable() {\n\n  const height = window.innerHeight - 170;\n\n  const [page, setPage] = useState(0);\n  const [rowsPerPage, setRowsPerPage] = useState(ROWS_PER_PAGE);\n  const text = useSelector(selectLang)\n\n  const { data: user } = useGetUserDataQuery()\n  const freeText = useSelector(selectInventoryFreeTextFilter);\n\n  const inventoryDate = useSelector(selectInventoryDateFilter);\n  const warehouseFilter = useSelector(selectInventoryWarehouseFilter);\n\n\n  useEffect(() => {\n    setPage(0)\n\n  }, [freeText]);\n\n  const {\n    data,\n    isLoading,\n  } = useGetInventoryQuery({ date: inventoryDate })\n\n  if (!data || isLoading) {\n    return <Loading />\n  }\n  const visableData =filterData(data, freeText, warehouseFilter);\n\n  const rowCount = visableData.length;\n  const showPegination = rowCount > ROWS_PER_PAGE;\n\n  visableData.sort((a, b) => a.resource.name.localeCompare(b.resource.name));\n\n\n  return (\n    <Box>\n      <TableContainer sx={{ padding: 0, maxHeight: height }}>\n        <Table stickyHeader size=\"small\" sx={{ width: '100%', margin: 0, padding: 0 }} aria-label=\"a dense table\">\n          <TableHead >\n            <TableRow\n            // style={{\n            //     height: 10,\n            // }}\n            >\n              <TableCell sx={headerSx} >{text.name}</TableCell>\n              <TableCell sx={headerSx} >{text.type}</TableCell>\n              <TableCell sx={headerSx} >{text.warehouse}</TableCell>\n              <TableCell sx={headerSx} >{text.qty}</TableCell>\n\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {visableData.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage).map((row, index) =>\n              <Row key={index} index={index} row={row} text={text}\n                user={user} />\n            )}\n          </TableBody>\n        </Table>\n      </TableContainer>\n      {showPegination && <Divider/>}\n      {showPegination && <ListPager bottom={0} page={Number(page)}\n        totalPages={Math.ceil(visableData.length / ROWS_PER_PAGE)} setPage={setPage} />}\n\n      <InventoryFilter />\n    </Box>\n\n  )\n}\n\nfunction getColor(value) {\n  if (!value || value === 0) {\n    return 'black';\n  } else if (value > 0) {\n    return 'green'\n  } else {\n    return 'red'\n  }\n}\n\nfunction Row(props) {\n  const { row, index, text, onClick } = props;\n  const resource = row.resource;\n  return (\n    <Fragment>\n      <TableRow style={{\n        height: 10,\n      }} onClick={onClick}\n        key={index}\n        sx={{ '&:last-child td, &:last-child th': { border: 0 } }}>\n        <TableCell sx={cellSx} >{resource.name}</TableCell>\n        <TableCell sx={cellSx} >{text[resource.type.toLowerCase()]}</TableCell>\n        <TableCell sx={cellSx} >{row.warehouse.name}</TableCell>\n        <TableCell sx={cellSxColor(getColor(row.qty))} >{row.qty}</TableCell>\n      </TableRow>\n    </Fragment>\n  );\n}\nexport default InventoryTable"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;AAEA,IAAM,aAAa,SAAC,MAAM,UAAU;IAElC,IAAI,SAAS,IAAA,yIAAa,EAAC,YAAY,OAAO,KAAK,MAAM,CAAC,SAAA;eAAK,EAAE,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC;;IAExF,IAAG,iBAAgB;QACjB,SAAS,OAAO,MAAM,CAAC,SAAA;mBAAG,EAAE,SAAS,CAAC,EAAE,KAAK;;IAC/C,OAAO;QACL,SAAS,OAAO,MAAM,CAAC,SAAA;mBAAG;;IAC5B;IACA,OAAO;AAET;AAEA,SAAS;;;IAEP,IAAM,SAAS,OAAO,WAAW,GAAG;IAEpC,IAAwB,qLAAA,IAAA,yKAAQ,EAAC,QAA1B,OAAiB,cAAX,UAAW;IACxB,IAAsC,sLAAA,IAAA,yKAAQ,EAAC,gKAAa,OAArD,cAA+B,eAAlB,iBAAkB;IACtC,IAAM,OAAO,IAAA,2KAAW,EAAC,mJAAU;IAEnC,IAAuB,uBAAA,IAAA,iKAAmB,KAAlC,AAAM,OAAS,qBAAf;IACR,IAAM,WAAW,IAAA,2KAAW,EAAC,sKAA6B;IAE1D,IAAM,gBAAgB,IAAA,2KAAW,EAAC,kKAAyB;IAC3D,IAAM,kBAAkB,IAAA,2KAAW,EAAC,uKAA8B;IAGlE,IAAA,0KAAS;oCAAC;YACR,QAAQ;QAEV;mCAAG;QAAC;KAAS;IAEb,IAGI,wBAAA,IAAA,4KAAoB,EAAC;QAAE,MAAM;IAAc,IAF7C,OAEE,sBAFF,MACA,YACE,sBADF;IAGF,IAAI,CAAC,QAAQ,WAAW;QACtB,qBAAO,6LAAC,0IAAO;;;;;IACjB;IACA,IAAM,cAAa,WAAW,MAAM,UAAU;IAE9C,IAAM,WAAW,YAAY,MAAM;IACnC,IAAM,iBAAiB,WAAW,gKAAa;IAE/C,YAAY,IAAI,CAAC,SAAC,GAAG;eAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,QAAQ,CAAC,IAAI;;IAGxE,qBACE,6LAAC,kMAAG;;0BACF,6LAAC,8OAAc;gBAAC,IAAI;oBAAE,SAAS;oBAAG,WAAW;gBAAO;0BAClD,cAAA,6LAAC,0MAAK;oBAAC,YAAY;oBAAC,MAAK;oBAAQ,IAAI;wBAAE,OAAO;wBAAQ,QAAQ;wBAAG,SAAS;oBAAE;oBAAG,cAAW;;sCACxF,6LAAC,0NAAS;sCACR,cAAA,6LAAC,sNAAQ;;kDAKP,6LAAC,0NAAS;wCAAC,IAAI,gIAAQ;kDAAI,KAAK,IAAI;;;;;;kDACpC,6LAAC,0NAAS;wCAAC,IAAI,gIAAQ;kDAAI,KAAK,IAAI;;;;;;kDACpC,6LAAC,0NAAS;wCAAC,IAAI,gIAAQ;kDAAI,KAAK,SAAS;;;;;;kDACzC,6LAAC,0NAAS;wCAAC,IAAI,gIAAQ;kDAAI,KAAK,GAAG;;;;;;;;;;;;;;;;;sCAIvC,6LAAC,0NAAS;sCACP,YAAY,KAAK,CAAC,OAAO,aAAa,OAAO,cAAc,aAAa,GAAG,CAAC,SAAC,KAAK;qDACjF,6LAAC;oCAAgB,OAAO;oCAAO,KAAK;oCAAK,MAAM;oCAC7C,MAAM;mCADE;;;;;;;;;;;;;;;;;;;;;;YAMjB,gCAAkB,6LAAC,kNAAO;;;;;YAC1B,gCAAkB,6LAAC,kJAAS;gBAAC,QAAQ;gBAAG,MAAM,OAAO;gBACpD,YAAY,KAAK,IAAI,CAAC,YAAY,MAAM,GAAG,gKAAa;gBAAG,SAAS;;;;;;0BAEtE,6LAAC,6JAAe;;;;;;;;;;;AAItB;GArES;;QAMM,2KAAW;QAED,iKAAmB;QACzB,2KAAW;QAEN,2KAAW;QACT,2KAAW;QAW/B,4KAAoB;;;KAvBjB;AAuET,SAAS,SAAS,KAAK;IACrB,IAAI,CAAC,SAAS,UAAU,GAAG;QACzB,OAAO;IACT,OAAO,IAAI,QAAQ,GAAG;QACpB,OAAO;IACT,OAAO;QACL,OAAO;IACT;AACF;AAEA,SAAS,IAAI,KAAK;IAChB,IAAQ,MAA8B,MAA9B,KAAK,QAAyB,MAAzB,OAAO,OAAkB,MAAlB,MAAM,UAAY,MAAZ;IAC1B,IAAM,WAAW,IAAI,QAAQ;IAC7B,qBACE,6LAAC,yKAAQ;kBACP,cAAA,6LAAC,sNAAQ;YAAC,OAAO;gBACf,QAAQ;YACV;YAAG,SAAS;YAEV,IAAI;gBAAE,oCAAoC;oBAAE,QAAQ;gBAAE;YAAE;;8BACxD,6LAAC,0NAAS;oBAAC,IAAI,8HAAM;8BAAI,SAAS,IAAI;;;;;;8BACtC,6LAAC,0NAAS;oBAAC,IAAI,8HAAM;8BAAI,IAAI,CAAC,SAAS,IAAI,CAAC,WAAW,GAAG;;;;;;8BAC1D,6LAAC,0NAAS;oBAAC,IAAI,8HAAM;8BAAI,IAAI,SAAS,CAAC,IAAI;;;;;;8BAC3C,6LAAC,0NAAS;oBAAC,IAAI,IAAA,mIAAW,EAAC,SAAS,IAAI,GAAG;8BAAM,IAAI,GAAG;;;;;;;WALnD;;;;;;;;;;AASb;MAjBS;uCAkBM"}},
    {"offset": {"line": 1412, "column": 0}, "map": {"version":3,"sources":["file:///home/tomer/VSCodeProjects/farm-manager-mobile-ui-next/src/ui/tabs/MainTabs.js"],"sourcesContent":["import Tabs from '@mui/material/Tabs';\nimport Tab from '@mui/material/Tab';\nimport Box from '@mui/material/Box';\nimport FieldsMap from './map/FieldsMap';\nimport { Link, useLocation, useParams } from 'react-router';\nimport FieldList from './fields/FieldList';\nimport { DEFAULT_ROUTE } from \"../../App\";\nimport ActivitiesList from './activities/ActivitiesList';\nimport { selectEditLayer, selectLang, selectShowInventory, selectShowPlans } from '../../features/app/appSlice';\nimport { useSelector } from 'react-redux';\nimport ActionFab from '../../components/ui/ActionFab';\nimport { useGetUserDataQuery } from '../../features/auth/authApiSlice';\nimport { isInventoryPossible, isPlansPossible } from '../FarmUtil';\nimport InventoryTable from './inventory/InventoryTable';\nfunction TabPanel(props) {\n    const { children, value, index, ...other } = props;\n\n    return (\n        <div\n            role=\"tabpanel\"\n            hidden={value !== index}\n            id={`simple-tabpanel-${index}`}\n            aria-labelledby={`simple-tab-${index}`}\n            {...other}\n        >\n            {value === index && (\n                <Box >\n                    {children}\n                </Box>\n            )}\n        </div>\n    );\n}\n\nfunction a11yProps(index) {\n    return {\n        id: `simple-tab-${index}`,\n        'aria-controls': `simple-tabpanel-${index}`,\n    };\n}\n\nconst inventoryPath = '/tabs/inventory';\nconst plansBasePath = '/tabs/plans/';\n\n\nconst MainTabs = () => {\n\n    const { pathname } = useLocation();\n    const { page } = useParams()\n    const text = useSelector(selectLang)\n\n\n    const plansPath = `${plansBasePath}${page}`;\n\n\n    const paths = ['/tabs/map', '/tabs/fields', `/tabs/activities/${page}`/*, `/tabs/plans/${page}`*/];\n\n    const { data: { userConf, usePlans } } = useGetUserDataQuery()\n    const showInventory = useSelector(selectShowInventory);\n    const isInventory = showInventory && isInventoryPossible(userConf);\n\n\n    const showPlans = useSelector(selectShowPlans);\n    const isPlans = showPlans && isPlansPossible(userConf);\n    const editLayer = useSelector(selectEditLayer);\n\n    if (isPlans) {\n        paths.push(plansPath)\n    }\n\n    if (isInventory) {\n        paths.push(inventoryPath)\n    }\n    const plansIndex = paths.findIndex((element) => element === plansPath)\n    const inventoryIndex = paths.findIndex((element) => element === inventoryPath)\n\n    const getIndex = ((element) => element === pathname);\n    const value = paths.findIndex(getIndex) > 0 ? paths.findIndex(getIndex) : 0;\n\n    const addScroll = paths.length > 4;\n\n    return (\n        <Box display={'flex'} flex={1} flexDirection={'column'}>\n            <Box alignItems={'stretch'} display={'flex'} flex={1} flexDirection={'column'} sx={{ borderBottom: 1, borderColor: 'divider' }}>\n                <Tabs value={value} aria-label=\"basic tabs example\"\n                    // indicatorColor=\"secondary\"\n                    textColor=\"inherit\"\n                    variant={addScroll ? 'scrollable' : 'fullWidth'}\n                    scrollButtons={addScroll}\n                    allowScrollButtonsMobile={addScroll}\n                // variant=\"scrollable\"\n                // scrollButtons={true}\n                // allowScrollButtonsMobile\n                >\n                    <Tab label={text.map} to={DEFAULT_ROUTE} component={Link}   {...a11yProps(0)} />\n                    <Tab label={text.fields} to=\"/tabs/fields\" component={Link} {...a11yProps(1)} />\n                    <Tab label={text.activities} to=\"/tabs/activities/0\" component={Link}  {...a11yProps(2)} />\n                    {/* {usePlans && <Tab label={text.plans} to=\"/tabs/plans/0\" component={Link}  {...a11yProps(3)} />}  */}\n\n                    {isPlans && <Tab label={text.plans} to={`${plansBasePath}${0}`} component={Link}  {...a11yProps(plansIndex)} />}\n\n                    {isInventory && <Tab label={text.inventory} to={inventoryPath} component={Link}  {...a11yProps(inventoryIndex)} />}\n\n                </Tabs>\n            </Box>\n            <TabPanel component={'div'} value={value} index={0}>\n                <FieldsMap />\n                {editLayer === null && <ActionFab map={true} plan={false} />}\n            </TabPanel>\n            <TabPanel value={value} index={1}>\n                <FieldList />\n                <ActionFab plan={false} />\n            </TabPanel>\n            <TabPanel value={value} index={2}>\n                <ActivitiesList plans={false} />\n                <ActionFab bottom={80} plan={false} />\n            </TabPanel>\n            {isPlans && <TabPanel value={value} index={plansIndex}>\n                <ActivitiesList plans={true} />\n                <ActionFab bottom={80} plan={true} />\n            </TabPanel>}\n            {isInventory && <TabPanel value={value} index={inventoryIndex}>\n                <InventoryTable />\n            </TabPanel>}\n\n        </Box>\n    );\n}\n\n\nexport default MainTabs;"],"names":[],"mappings":"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"}}]
}